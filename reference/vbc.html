<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Correct zero inflated climate model simulations via vine copulas — vbc • VBC</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Correct zero inflated climate model simulations via vine copulas — vbc"><meta name="description" content="The multivariate distribution functions of model and observed are estimated
via vine copula estimation (see rvinecopulib::vine).
This method provides the tool to model the multivariate distribution function
of the climate data by Vine Copulas. The climate variables may be zero
inflated.
The quantiles are then mapped via (inverse) Rosenblatt transformation from
the model to the observed distribution. The corrected data are mapped to the
projection domain via delta mapping. The steps are equivalent to those in
univariate bias correction via quantile delta mapping."><meta property="og:description" content="The multivariate distribution functions of model and observed are estimated
via vine copula estimation (see rvinecopulib::vine).
This method provides the tool to model the multivariate distribution function
of the climate data by Vine Copulas. The climate variables may be zero
inflated.
The quantiles are then mapped via (inverse) Rosenblatt transformation from
the model to the observed distribution. The corrected data are mapped to the
projection domain via delta mapping. The steps are equivalent to those in
univariate bias correction via quantile delta mapping."><meta property="og:image" content="https://henrifnk.github.io/VBC/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">VBC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/vbc_alps.html">VBC in the Alps: Multivariate Bias Correction and Evaluation</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Correct zero inflated climate model simulations via vine copulas</h1>

      <div class="d-none name"><code>vbc.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The multivariate distribution functions of model and observed are estimated
via vine copula estimation (see <a href="https://vinecopulib.github.io/rvinecopulib/reference/vine.html" class="external-link">rvinecopulib::vine</a>).
This method provides the tool to model the multivariate distribution function
of the climate data by Vine Copulas. The climate variables may be zero
inflated.
The quantiles are then mapped via (inverse) Rosenblatt transformation from
the model to the observed distribution. The corrected data are mapped to the
projection domain via delta mapping. The steps are equivalent to those in
univariate bias correction via quantile delta mapping.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">vbc</span><span class="op">(</span></span>
<span>  <span class="va">mp</span>,</span>
<span>  <span class="va">mc</span>,</span>
<span>  <span class="va">rc</span>,</span>
<span>  var_names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">rc</span><span class="op">)</span>,</span>
<span>  margins_controls <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mult <span class="op">=</span> <span class="cn">NULL</span>, xmin <span class="op">=</span> <span class="cn">NaN</span>, xmax <span class="op">=</span> <span class="cn">NaN</span>, bw <span class="op">=</span> <span class="cn">NA</span>, deg <span class="op">=</span> <span class="fl">2</span>, type <span class="op">=</span></span>
<span>    <span class="st">"c"</span><span class="op">)</span>,</span>
<span>  time_mp <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-mp">mp<a class="anchor" aria-label="anchor" href="#arg-mp"></a></dt>
<dd><p><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a> OR <a href="https://rdrr.io/r/base/list.html" class="external-link">list</a><br>
Simulation data from a climate model during projection period. If this is a
list, the algorithm expects each element to be a member of a model ensemble.
Each list element is then a data table.</p></dd>


<dt id="arg-mc">mc<a class="anchor" aria-label="anchor" href="#arg-mc"></a></dt>
<dd><p><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a><br>
Simulation data from a climate model during calibration period.</p></dd>


<dt id="arg-rc">rc<a class="anchor" aria-label="anchor" href="#arg-rc"></a></dt>
<dd><p><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a><br>
Historical reference in calibration period.</p></dd>


<dt id="arg-var-names">var_names<a class="anchor" aria-label="anchor" href="#arg-var-names"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/character.html" class="external-link">character</a><br>
Names of corrected climate data. Defaults to the column names of the
observed data <code>rc</code>.</p></dd>


<dt id="arg-margins-controls">margins_controls<a class="anchor" aria-label="anchor" href="#arg-margins-controls"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a><br>
A list with arguments to be passed to <code><a href="https://tnagler.github.io/kde1d/reference/kde1d.html" class="external-link">kde1d::kde1d()</a></code>. Currently, there can be</p><ul><li><p><code>mult</code> numeric vector of length one or d; all bandwidths for marginal
kernel density estimation are multiplied with <code>mult</code>. Defaults to
<code>log(1 + d)</code> where <code>d</code> is the number of climate variables.</p></li>
<li><p><code>xmin</code> numeric vector of length d; see <code><a href="https://tnagler.github.io/kde1d/reference/kde1d.html" class="external-link">kde1d::kde1d()</a></code>.</p></li>
<li><p><code>xmax</code> numeric vector of length d; see <code><a href="https://tnagler.github.io/kde1d/reference/kde1d.html" class="external-link">kde1d::kde1d()</a></code>.</p></li>
<li><p><code>bw</code> numeric vector of length d; see <code><a href="https://tnagler.github.io/kde1d/reference/kde1d.html" class="external-link">kde1d::kde1d()</a></code>.</p></li>
<li><p><code>deg</code> numeric vector of length one or d; <code><a href="https://tnagler.github.io/kde1d/reference/kde1d.html" class="external-link">kde1d::kde1d()</a></code>.</p></li>
<li><p><code>type</code> character vector of length one or d; must be one of
c, cont, continuous for continuous variables, one of d, disc, discrete for
discrete integer variables, or one of zi, zinfl, zero-inflated for
zero-inflated variables.</p></li>
</ul></dd>


<dt id="arg-time-mp">time_mp<a class="anchor" aria-label="anchor" href="#arg-time-mp"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/numeric.html" class="external-link">numeric</a><br>
Time vector of the projection period attached to the returned object as a
column. Defaults to <code>NA</code>, which means no time vector is attached.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p><br>
Arguments are passed to <a href="https://vinecopulib.github.io/rvinecopulib/reference/vinecop.html" class="external-link">rvinecopulib::vinecop</a> to specify the structure of
vines and margins. Note that the ellipsis of observed and model data are
specified with the same arguments.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p><a href="https://rdrr.io/pkg/data.table/man/data.table.html" class="external-link">data.table</a> OR <a href="https://rdrr.io/r/base/list.html" class="external-link">list</a><br>
The corrected projection period data in <code>mp</code>. Additionally the data frame
contains the attributes <code>vine_rc</code>, <code>kde_rc</code>, <code>vine_mp</code>, and <code>kde_mp</code> which
store the vine copula and kernel density estimation objects of the observed
and model data.
If <code>mp</code> is a list, the function returns a list of corrected data frames for
each member of the model ensemble.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Czado, C. (2019). Analyzing dependent data with vine copulas. Lecture Notes
in Statistics, Springer, 222.</p>
<p>Rosenblatt, M. (1952). Remarks on a multivariate transformation. The annals
of mathematical statistics, 23(3), 470-472.</p>
<p>Cannon, A.J., S.R. Sobie, and T.Q. Murdock, (2015). Bias correction of
simulated precipitation by quantile mapping: How well do methods preserve
relative changes in quantiles and extremes? Journal of Climate, 28:6938-6959.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#' \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">#' # Start with a simple example:</span></span></span>
<span class="r-in"><span><span class="co">#' # There is one timeline that should be corrected and projection and </span></span></span>
<span class="r-in"><span><span class="co">#' # calibaration period are both in 2010.</span></span></span>
<span class="r-in"><span><span class="co">#' set.seed(1234L)</span></span></span>
<span class="r-in"><span><span class="co">#' library(VBC)</span></span></span>
<span class="r-in"><span><span class="co">#' library(data.table)</span></span></span>
<span class="r-in"><span><span class="co">#' library(patchwork)</span></span></span>
<span class="r-in"><span><span class="co">#' data("climate")</span></span></span>
<span class="r-in"><span><span class="co">#' margins_controls &lt;- list(xmin = c(NaN, 0, NaN, 0, 0),</span></span></span>
<span class="r-in"><span><span class="co">#'                          type = c("c", "zi", "c", "zi", "c"))</span></span></span>
<span class="r-in"><span><span class="co">#'                   </span></span></span>
<span class="r-in"><span><span class="co">#' climate_2010 = lapply(climate, function(data) data[year(time) == 2010, ])</span></span></span>
<span class="r-in"><span><span class="co">#' </span></span></span>
<span class="r-in"><span><span class="co">#' mp_vbc = vbc(climate_2010$mp[, -"time"], climate_2010$mp[, -"time"],</span></span></span>
<span class="r-in"><span><span class="co">#'              climate_2010$rp[, -"time"], margins_controls = margins_controls,</span></span></span>
<span class="r-in"><span><span class="co">#'              family_set = "tll", trunc_lvl = Inf)                 </span></span></span>
<span class="r-in"><span><span class="co">#' </span></span></span>
<span class="r-in"><span><span class="co">#' plot_tails(climate_2010$mp, "pr", scale_d = 0.1, mult = 4, xmin = 0) </span></span></span>
<span class="r-in"><span><span class="co">#' plot_tails(climate_2010$rp, "pr", scale_d = 1, mult = 4, xmin = 0)</span></span></span>
<span class="r-in"><span><span class="co">#' plot_tails(round(mp_vbc, 3), "pr", scale_d = 1, mult = 3, xmin = 0)</span></span></span>
<span class="r-in"><span><span class="co">#' calc_wasserstein(climate_2010$mp[, "pr"], climate_2010$rp[, "pr"])</span></span></span>
<span class="r-in"><span><span class="co">#' calc_wasserstein(climate_2010$rp[, "pr"], mp_vbc[, "pr"])</span></span></span>
<span class="r-in"><span><span class="co">#' </span></span></span>
<span class="r-in"><span><span class="co">#' calc_wasserstein(climate_2010$rp[, -"time"], climate_2010$mp[, -"time"])</span></span></span>
<span class="r-in"><span><span class="co">#' calc_wasserstein(climate_2010$rp[, -"time"], mp_vbc)</span></span></span>
<span class="r-in"><span><span class="co">#' </span></span></span>
<span class="r-in"><span><span class="co">#' # An example with temporal subsetting using the method of fragments</span></span></span>
<span class="r-in"><span><span class="co">#'  </span></span></span>
<span class="r-in"><span><span class="co">#' temp_subs &lt;- list(DJF = list(hours = seq(0, 21, 3), month = c(12, 1, 2)),</span></span></span>
<span class="r-in"><span><span class="co">#'                   MAM = list(hours = seq(0, 21, 3), month = 3:5),</span></span></span>
<span class="r-in"><span><span class="co">#'                   JJA = list(hours = seq(0, 21, 3), month = 6:8),</span></span></span>
<span class="r-in"><span><span class="co">#'                   SON = list(hours = seq(0, 21, 3), month = 9:11))  </span></span></span>
<span class="r-in"><span><span class="co">#'                                  </span></span></span>
<span class="r-in"><span><span class="co">#' mp_vbc = vbc_tsub(climate$mp, climate$mc, climate$rc, t_subs = temp_subs,</span></span></span>
<span class="r-in"><span><span class="co">#'                   margins_controls = margins_controls, family_set = "tll",</span></span></span>
<span class="r-in"><span><span class="co">#'                   trunc_lvl = Inf)</span></span></span>
<span class="r-in"><span><span class="co">#' class(mp_vbc)</span></span></span>
<span class="r-in"><span><span class="co">#' attr(mp_vbc, "mvd")</span></span></span>
<span class="r-in"><span><span class="co">#' </span></span></span>
<span class="r-in"><span><span class="co">#' measure = lapply(temp_subs, function(sub) {</span></span></span>
<span class="r-in"><span><span class="co">#'    idx = which(hour(mp_vbc$time) %in% sub$hour &amp;</span></span></span>
<span class="r-in"><span><span class="co">#'                   month(mp_vbc$time) %in% sub$month)</span></span></span>
<span class="r-in"><span><span class="co">#'    idxrp = which(hour(climate$rp$time) %in% sub$hour &amp;</span></span></span>
<span class="r-in"><span><span class="co">#'                      month(climate$rp$time) %in% sub$month)</span></span></span>
<span class="r-in"><span><span class="co">#'    mci = calc_mci(climate$mp[idx, -"time"], mp_vbc[idx, -"time"],</span></span></span>
<span class="r-in"><span><span class="co">#'                     time = climate$mp$time[idx])</span></span></span>
<span class="r-in"><span><span class="co">#'    mci = attr(mci, "global_mci")</span></span></span>
<span class="r-in"><span><span class="co">#'    </span></span></span>
<span class="r-in"><span><span class="co">#'    uncorrected = calc_wasserstein(climate$rp[idxrp, -"time"],</span></span></span>
<span class="r-in"><span><span class="co">#'                                     climate$mp[idx, -"time"])</span></span></span>
<span class="r-in"><span><span class="co">#'    corrected = calc_wasserstein(climate$rp[idxrp, -"time"],</span></span></span>
<span class="r-in"><span><span class="co">#'                                 mp_vbc[idx, -"time"])</span></span></span>
<span class="r-in"><span><span class="co">#'    data.table(</span></span></span>
<span class="r-in"><span><span class="co">#'        ModelCorrectionInconsistancy = mci,</span></span></span>
<span class="r-in"><span><span class="co">#'        Wasserstein2_uncorrected = uncorrected[2],</span></span></span>
<span class="r-in"><span><span class="co">#'        Wasserstein2_corrected = corrected[2],</span></span></span>
<span class="r-in"><span><span class="co">#'        Improvement_Wasserstein2 = uncorrected[2] - corrected[2], </span></span></span>
<span class="r-in"><span><span class="co">#'        month = paste(sub$month, collapse = "-")</span></span></span>
<span class="r-in"><span><span class="co">#'        )</span></span></span>
<span class="r-in"><span><span class="co">#' })</span></span></span>
<span class="r-in"><span><span class="co">#' rbindlist(measure)</span></span></span>
<span class="r-in"><span><span class="co">#' }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Henri Funk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

