<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Calculate Wasserstein Distance — calc_wasserstein • VBC</title><!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png"><link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png"><link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png"><link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png"><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculate Wasserstein Distance — calc_wasserstein"><meta name="description" content="Calculate the Wasserstein distance of order 1 and 2 between
multivariate distributions of model and observed data. Can be used to
evaluate the performance of a bias correction method by comparing the
distribution of the model data after the correction."><meta property="og:description" content="Calculate the Wasserstein distance of order 1 and 2 between
multivariate distributions of model and observed data. Can be used to
evaluate the performance of a bias correction method by comparing the
distribution of the model data after the correction."><meta property="og:image" content="https://henrifnk.github.io/VBC/logo.svg"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">VBC</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/vbc_alps.html">VBC in the Alps: Multivariate Bias Correction and Evaluation</a></li>
  </ul></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.svg" class="logo" alt=""><h1>Calculate Wasserstein Distance</h1>

      <div class="d-none name"><code>calc_wasserstein.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Calculate the Wasserstein distance of order 1 and 2 between
multivariate distributions of model and observed data. Can be used to
evaluate the performance of a bias correction method by comparing the
distribution of the model data after the correction.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">calc_wasserstein</span><span class="op">(</span></span>
<span>  <span class="va">observed</span>,</span>
<span>  <span class="va">model</span>,</span>
<span>  n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">observed</span><span class="op">)</span>,</span>
<span>  scale_dta <span class="op">=</span> <span class="st">"observed"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-observed">observed<a class="anchor" aria-label="anchor" href="#arg-observed"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a><br>
Measured (and interpolated) observations.</p></dd>


<dt id="arg-model">model<a class="anchor" aria-label="anchor" href="#arg-model"></a></dt>
<dd><p><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a><br>
Simulation climate data from the climate model.</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p><code>integer(1)</code><br>
Length of samples to be drawn from model and observed data.</p></dd>


<dt id="arg-scale-dta">scale_dta<a class="anchor" aria-label="anchor" href="#arg-scale-dta"></a></dt>
<dd><p><code>cahracter(1)</code><br>
Scale the data before calculating the Wasserstein distance. Default is
"observed". Possible values are "both", "observed", and "sd". If "both" the
data are scaled to zero mean and unit variance. If "observed" the data are
scaled to zero mean and unit variance of the observed data. If "sd" the data
are scaled to zero mean and unit variance.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p><br>
Further arguments passed to <a href="https://rdrr.io/pkg/transport/man/transport.html" class="external-link">transport::transport</a>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A named vector of length 2.<br></p><ul><li><p>Wasserstein_1: The Wasserstein distance of order 1</p></li>
<li><p>Wasserstein_2: The Wasserstein distance of order 2</p></li>
</ul></div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/pkg/transport/man/wasserstein.html" class="external-link">transport::wasserstein()</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co">#' \dontrun{</span></span></span>
<span class="r-in"><span><span class="co">#' # Start with a simple example:</span></span></span>
<span class="r-in"><span><span class="co">#' # There is one timeline that should be corrected and projection and </span></span></span>
<span class="r-in"><span><span class="co">#' # calibaration period are both in 2010.</span></span></span>
<span class="r-in"><span><span class="co">#' set.seed(1234L)</span></span></span>
<span class="r-in"><span><span class="co">#' library(VBC)</span></span></span>
<span class="r-in"><span><span class="co">#' library(data.table)</span></span></span>
<span class="r-in"><span><span class="co">#' library(patchwork)</span></span></span>
<span class="r-in"><span><span class="co">#' data("climate")</span></span></span>
<span class="r-in"><span><span class="co">#' margins_controls &lt;- list(xmin = c(NaN, 0, NaN, 0, 0),</span></span></span>
<span class="r-in"><span><span class="co">#'                          type = c("c", "zi", "c", "zi", "c"))</span></span></span>
<span class="r-in"><span><span class="co">#'                   </span></span></span>
<span class="r-in"><span><span class="co">#' climate_2010 = lapply(climate, function(data) data[year(time) == 2010, ])</span></span></span>
<span class="r-in"><span><span class="co">#' </span></span></span>
<span class="r-in"><span><span class="co">#' mp_vbc = vbc(climate_2010$mp[, -"time"], climate_2010$mp[, -"time"],</span></span></span>
<span class="r-in"><span><span class="co">#'              climate_2010$rp[, -"time"], margins_controls = margins_controls,</span></span></span>
<span class="r-in"><span><span class="co">#'              family_set = "tll", trunc_lvl = Inf)                 </span></span></span>
<span class="r-in"><span><span class="co">#' </span></span></span>
<span class="r-in"><span><span class="co">#' plot_tails(climate_2010$mp, "pr", scale_d = 0.2, offset = 3)  </span></span></span>
<span class="r-in"><span><span class="co">#' plot_tails(climate_2010$rp, "pr", scale_d = 1.8, offset = 3) </span></span></span>
<span class="r-in"><span><span class="co">#' plot_tails(mp_vbc, "pr", scale_d = 1.8, offset = 20) </span></span></span>
<span class="r-in"><span><span class="co">#' calc_wasserstein(climate_2010$mp[, "pr"], climate_2010$rp[, "pr"])</span></span></span>
<span class="r-in"><span><span class="co">#' calc_wasserstein(climate_2010$rp[, "pr"], mp_vbc[, "pr"])</span></span></span>
<span class="r-in"><span><span class="co">#' </span></span></span>
<span class="r-in"><span><span class="co">#' calc_wasserstein(climate_2010$rp[, -"time"], climate_2010$mp[, -"time"])</span></span></span>
<span class="r-in"><span><span class="co">#' calc_wasserstein(climate_2010$rp[, -"time"], mp_vbc)</span></span></span>
<span class="r-in"><span><span class="co">#' </span></span></span>
<span class="r-in"><span><span class="co">#' # An example with temporal subsetting using the method of fragments</span></span></span>
<span class="r-in"><span><span class="co">#'  </span></span></span>
<span class="r-in"><span><span class="co">#' temp_subs &lt;- list(DJF = list(hours = seq(0, 21, 3), month = c(12, 1, 2)),</span></span></span>
<span class="r-in"><span><span class="co">#'                   MAM = list(hours = seq(0, 21, 3), month = 3:5),</span></span></span>
<span class="r-in"><span><span class="co">#'                   JJA = list(hours = seq(0, 21, 3), month = 6:8),</span></span></span>
<span class="r-in"><span><span class="co">#'                   SON = list(hours = seq(0, 21, 3), month = 9:11))  </span></span></span>
<span class="r-in"><span><span class="co">#'                                  </span></span></span>
<span class="r-in"><span><span class="co">#' mp_vbc = vbc_tsub(climate$mp, climate$mc, climate$rc, t_subs = temp_subs,</span></span></span>
<span class="r-in"><span><span class="co">#'                   margins_controls = margins_controls, family_set = "tll",</span></span></span>
<span class="r-in"><span><span class="co">#'                   trunc_lvl = Inf)</span></span></span>
<span class="r-in"><span><span class="co">#' class(mp_vbc)</span></span></span>
<span class="r-in"><span><span class="co">#' attr(mp_vbc, "mvd")</span></span></span>
<span class="r-in"><span><span class="co">#' </span></span></span>
<span class="r-in"><span><span class="co">#' measure = lapply(temp_subs, function(sub) {</span></span></span>
<span class="r-in"><span><span class="co">#'    idx = which(hour(mp_vbc$time) %in% sub$hour &amp;</span></span></span>
<span class="r-in"><span><span class="co">#'                   month(mp_vbc$time) %in% sub$month)</span></span></span>
<span class="r-in"><span><span class="co">#'    idxrp = which(hour(climate$rp$time) %in% sub$hour &amp;</span></span></span>
<span class="r-in"><span><span class="co">#'                      month(climate$rp$time) %in% sub$month)</span></span></span>
<span class="r-in"><span><span class="co">#'    mci = calc_mci(climate$mp[idx, -"time"], mp_vbc[idx, -"time"],</span></span></span>
<span class="r-in"><span><span class="co">#'                     time = climate$mp$time[idx])</span></span></span>
<span class="r-in"><span><span class="co">#'    mci = attr(mci, "global_mci")</span></span></span>
<span class="r-in"><span><span class="co">#'    </span></span></span>
<span class="r-in"><span><span class="co">#'    uncorrected = calc_wasserstein(climate$rp[idxrp, -"time"],</span></span></span>
<span class="r-in"><span><span class="co">#'                                     climate$mp[idx, -"time"])</span></span></span>
<span class="r-in"><span><span class="co">#'    corrected = calc_wasserstein(climate$rp[idxrp, -"time"],</span></span></span>
<span class="r-in"><span><span class="co">#'                                 mp_vbc[idx, -"time"])</span></span></span>
<span class="r-in"><span><span class="co">#'    data.table(</span></span></span>
<span class="r-in"><span><span class="co">#'        ModelCorrectionInconsistancy = mci,</span></span></span>
<span class="r-in"><span><span class="co">#'        Wasserstein2_uncorrected = uncorrected[2],</span></span></span>
<span class="r-in"><span><span class="co">#'        Wasserstein2_corrected = corrected[2],</span></span></span>
<span class="r-in"><span><span class="co">#'        Improvement_Wasserstein2 = uncorrected[2] - corrected[2], </span></span></span>
<span class="r-in"><span><span class="co">#'        month = paste(sub$month, collapse = "-")</span></span></span>
<span class="r-in"><span><span class="co">#'        )</span></span></span>
<span class="r-in"><span><span class="co">#' })</span></span></span>
<span class="r-in"><span><span class="co">#' rbindlist(measure)</span></span></span>
<span class="r-in"><span><span class="co">#' }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Henri Funk.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

